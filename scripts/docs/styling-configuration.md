# Mermaid Graph Styling Configuration

The validation system includes a configuration system for customizing Mermaid graph styling through `risk-map/yaml/mermaid-styles.yaml`. This configuration file controls all visual aspects of both component graphs and control graphs generated by the validation scripts.

## Configuration File Structure

The `mermaid-styles.yaml` file is organized into four main sections:

### 1. Foundation Design Tokens

```yaml
foundation:
  colors:
    primary: '#4285f4' # Google Blue - primary actions
    success: '#34a853' # Google Green - success states
    accent: '#9c27b0' # Purple - accent elements
    # ... additional semantic colors
  strokeWidths:
    thin: '1px' # Subgroup borders
    medium: '2px' # Standard borders
    thick: '3px' # Emphasis elements
  strokePatterns:
    solid: '' # Solid lines
    dashed: '5 5' # Dashed pattern
    # ... additional patterns
```

### 2. Shared Elements

```yaml
sharedElements:
  cssClasses:
    hidden: 'display: none;'
    allControl: 'stroke:#4285f4,stroke-width:2px,stroke-dasharray: 5 5'
  componentCategories:
    componentsInfrastructure:
      fill: '#e6f3e6' # Light green
      stroke: '#333333' # Dark border
      strokeWidth: '2px'
      subgroupFill: '#d4e6d4' # Darker green for subgroups
```

### 3. Graph-Specific Configuration

```yaml
graphTypes:
  component:
    direction: 'TD' # Top-down layout
    flowchartConfig:
      padding: 5 # Internal node padding
      wrappingWidth: 250 # Text wrapping width
  control:
    direction: 'LR' # Left-right layout
    flowchartConfig:
      nodeSpacing: 25 # Space between nodes
      rankSpacing: 150 # Space between ranks/levels
      padding: 5
      wrappingWidth: 250
    specialStyling:
      edgeStyles:
        multiEdgeStyles: # 4-color cycling for complex controls
          - stroke: '#9c27b0'
            strokeWidth: '2px'
  risk:
    direction: 'LR' # Left-right layout for three layers
    flowchartConfig:
      nodeSpacing: 30 # Increased spacing for three-layer complexity
      rankSpacing: 40 # Increased spacing between layers
      padding: 5
      wrappingWidth: 250
    specialStyling:
      # Risk category styling (single generic category)
      riskCategories:
        risks:
          fill: '#ffeef0' # Light pink background for risk category
          stroke: '#e91e63' # Pink border for risk emphasis
          strokeWidth: '2px'
          subgroupFill: '#ffe0e6' # Darker pink for risk subgroups
      # Container styling for three layers
      componentsContainer:
        fill: '#f0f0f0'
        stroke: '#666666'
        strokeWidth: '3px'
        strokeDasharray: '10 5'
      controlsContainer:
        fill: '#f0f0f0'
        stroke: '#666666'
        strokeWidth: '3px'
        strokeDasharray: '10 5'
      risksContainer:
        fill: '#f0f0f0'
        stroke: '#666666'
        strokeWidth: '3px'
        strokeDasharray: '10 5'
```

## Customizing Graph Appearance

To customize graph styling:

1. **Edit Configuration**: Modify `risk-map/yaml/mermaid-styles.yaml`
2. **Validate Changes**: The pre-commit hooks automatically validate syntax and schema
3. **Test Changes**: Use `--force` mode to test with unstaged changes:
   ```bash
   python3 scripts/hooks/validate_riskmap.py --to-graph test.md --force
   ```

## Common Customizations

### Change Component Category Colors

```yaml
sharedElements:
  componentCategories:
    componentsInfrastructure:
      fill: '#your-color' # Background color
      stroke: '#border-color' # Border color
      strokeWidth: '2px'
      subgroupFill: '#sub-color' # Subgroup background
    componentsApplication:
      fill: '#another-color'
      stroke: '#border-color'
      strokeWidth: '2px'
      subgroupFill: '#sub-color'
```

### Modify Graph Layout

```yaml
graphTypes:
  component:
    direction: 'LR' # Change to left-right layout
  control:
    flowchartConfig:
      nodeSpacing: 40 # Increase node spacing
      wrappingWidth: 300 # Wider text wrapping
```

### Update Multi-Edge Control Colors

```yaml
graphTypes:
  control:
    specialStyling:
      edgeStyles:
        multiEdgeStyles:
          - stroke: '#ff0000' # Red
            strokeWidth: '3px' # Thicker lines
          - stroke: '#00ff00' # Green
            strokeDasharray: '10 5' # Custom dash pattern
```

### Customize Risk Category Colors

```yaml
graphTypes:
  risk:
    specialStyling:
      riskCategories:
        risks:
          fill: '#ffeef0' # Light pink background for risk category
          stroke: '#e91e63' # Pink border for risk emphasis
          strokeWidth: '2px'
          subgroupFill: '#ffe0e6' # Darker pink for risk subgroups
```

**Note**: The configuration uses a single `risks` category for all risk styling. Individual risk categories (defined in `risks.yaml`) share this same visual styling.

### Style Three-Layer Containers

```yaml
graphTypes:
  risk:
    specialStyling:
      componentsContainer:
        fill: '#e8f5e9' # Light green - bottom layer (components)
        stroke: '#4caf50' # Green border
        strokeWidth: '3px'
      controlsContainer:
        fill: '#e3f2fd' # Light blue - middle layer (controls)
        stroke: '#2196f3' # Blue border
        strokeWidth: '3px'
      risksContainer:
        fill: '#fce4ec' # Light pink - top layer (risks)
        stroke: '#e91e63' # Pink border
        strokeWidth: '3px'
```

## Validation and Schema

The configuration file is automatically validated against `risk-map/schemas/mermaid-styles.schema.json` which enforces:

- **Color format validation**: All colors must be valid hex values (#RRGGBB)
- **Required properties**: All essential configuration elements must be present
- **Value constraints**: Spacing values, direction options, and stroke patterns are validated
- **Structure validation**: Proper nesting and organization is enforced

## Error Handling

The system includes a set of fallback mechanisms:

- **Missing file**: Uses hardcoded emergency defaults matching original styling
- **Invalid configuration**: Falls back to emergency defaults while reporting errors
- **Partial configuration**: Missing elements use sensible defaults from emergency configuration

This ensures graph generation never fails due to configuration issues, maintaining system reliability while providing customization flexibility.

---

**Related:**
- [Graph Generation](graph-generation.md) - Generating graphs with custom styling
- [Hook Validations](hook-validations.md) - Automatic graph generation
- [Troubleshooting](troubleshooting.md) - Configuration validation errors
